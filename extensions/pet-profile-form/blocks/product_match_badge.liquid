<div class="pp-match-badge-container" 
     data-product-id="{{ product.id }}" 
     data-customer-id="{{ customer.id }}"
     data-show-unmatched="{{ block.settings.show_unmatched }}"
     style="--match-color: {{ block.settings.match_color }}; --no-match-color: {{ block.settings.no_match_color }};">
  
  <div id="pp-match-badge-loading" class="pp-match-loading">
    <span class="pp-match-spinner"></span> Checking matches...
  </div>

  <div id="pp-match-badge-content" style="display: none;">
    <!-- Populated by JS -->
  </div>
</div>

<script src="{{ 'product_match_badge.js' | asset_url }}" defer="defer"></script>

{% style %}
  .pp-match-badge-container {
    margin: 1rem 0;
    font-family: inherit;
  }
  .pp-match-loading {
    font-size: 0.9em;
    color: #666;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .pp-match-spinner {
    width: 16px;
    height: 16px;
    border: 2px solid #ccc;
    border-top-color: #333;
    border-radius: 50%;
    animation: pp-spin 1s linear infinite;
  }
  @keyframes pp-spin {
    to { transform: rotate(360deg); }
  }
  .pp-match-item {
    display: inline-flex;
    align-items: center;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 500;
    margin-right: 8px;
    margin-bottom: 8px;
  }
  .pp-match-item--matched {
    background-color: {{ block.settings.match_color | color_modify: 'alpha', 0.1 }};
    color: {{ block.settings.match_color }};
    border: 1px solid {{ block.settings.match_color | color_modify: 'alpha', 0.2 }};
  }
  .pp-match-item--unmatched {
    background-color: #f4f4f4;
    color: #666;
    border: 1px solid #ddd;
  }
  .pp-match-icon {
    margin-right: 6px;
  }
{% endstyle %}

{% schema %}
{
  "name": "Product Match Badge",
  "target": "section",
  "enabled_on": {
    "templates": ["product"]
  },
  "settings": [
    {
      "type": "color",
      "id": "match_color",
      "label": "Match Color",
      "default": "#008060"
    },
    {
      "type": "color",
      "id": "no_match_color",
      "label": "No Match Color",
      "default": "#666666"
    },
    {
      "type": "checkbox",
      "id": "show_unmatched",
      "label": "Show unmatched pets",
      "default": true
    }
  ]
}
{% endschema %}
